# 12.2 Embedding & å‘é‡æ•°æ®åº“ <DifficultyBadge level="intermediate" /> <CostBadge cost="$0.01" />

> å¦‚ä½•è®© AI çŸ¥é“"ç‹—"å’Œ"çŠ¬ç±»"æ˜¯ä¸€å›äº‹ï¼ŸæŠŠæ–‡å­—å˜æˆ **GPS åæ ‡**ï¼Œè·ç¦»è¿‘çš„å°±æ˜¯ç›¸ä¼¼çš„ï¼

> å‰ç½®çŸ¥è¯†:12.1 RAG åŸºç¡€

### ä¸ºä»€ä¹ˆéœ€è¦å®ƒ?(Problem)

::: warning å…³é”®è¯æœç´¢çš„æ‚²å‰§
**åœºæ™¯ï¼š**ä½ æœç´¢"å¦‚ä½•è®­ç»ƒç‹—"

æ–‡æ¡£ Aï¼š"ç‹—çš„è®­ç»ƒæ–¹æ³•..." âœ… å‘½ä¸­
æ–‡æ¡£ Bï¼š"çŠ¬ç±»çš„åŸ¹è®­æŠ€å·§..." âŒ æ²¡å‘½ä¸­ï¼ˆæ²¡æœ‰"ç‹—"å’Œ"è®­ç»ƒ"è¿™ä¸¤ä¸ªè¯ï¼‰
æ–‡æ¡£ Cï¼š"çŒ«çš„é¥®é£Ÿä¹ æƒ¯..." âŒ æ²¡å‘½ä¸­

**é—®é¢˜ï¼š**å…³é”®è¯åŒ¹é…åƒä¸ªæ­»è„‘ç­‹ï¼Œä¸æ‡‚"ç‹—=çŠ¬ç±»"ã€"è®­ç»ƒ=åŸ¹è®­"
:::

**é—®é¢˜:æ–‡æœ¬ç›¸ä¼¼åº¦æ€ä¹ˆè®¡ç®—?**

```python
# åœºæ™¯:ç”¨æˆ·æœç´¢"å¦‚ä½•è®­ç»ƒç‹—"
æ–‡æ¡£ A:"ç‹—çš„è®­ç»ƒæ–¹æ³•åŒ…æ‹¬å¥–åŠ±å’Œæƒ©ç½š..."
æ–‡æ¡£ B:"çŒ«çš„é¥®é£Ÿä¹ æƒ¯æ˜¯..."
æ–‡æ¡£ C:"çŠ¬ç±»çš„åŸ¹è®­æŠ€å·§æ¶‰åŠæ­£å¼ºåŒ–..."

# å…³é”®è¯åŒ¹é…:
"è®­ç»ƒç‹—" vs æ–‡æ¡£ A â†’ å‘½ä¸­"è®­ç»ƒ"å’Œ"ç‹—" âœ…
"è®­ç»ƒç‹—" vs æ–‡æ¡£ B â†’ æ— å‘½ä¸­ âŒ
"è®­ç»ƒç‹—" vs æ–‡æ¡£ C â†’ æ— å‘½ä¸­("çŠ¬ç±»"ã€"åŸ¹è®­",æ²¡æœ‰"ç‹—"å’Œ"è®­ç»ƒ") âŒ

# é—®é¢˜:å…³é”®è¯åŒ¹é…æ— æ³•ç†è§£è¯­ä¹‰
"ç‹—" = "çŠ¬ç±»"?
"è®­ç»ƒ" = "åŸ¹è®­"?
```

**Embedding çš„ä½œç”¨:å°†è¯­ä¹‰è½¬æ¢ä¸ºæ•°å­—**

```
æ–‡æœ¬ â†’ Embedding æ¨¡å‹ â†’ å‘é‡(æ•°å­—æ•°ç»„)

"ç‹—çš„è®­ç»ƒ"    â†’ [0.8, 0.1, -0.3, ...]
"çŠ¬ç±»çš„åŸ¹è®­"  â†’ [0.78, 0.12, -0.28, ...]  # å‘é‡æ¥è¿‘!
"çŒ«çš„é¥®é£Ÿ"    â†’ [-0.2, 0.9, 0.5, ...]     # å‘é‡è¿œç¦»!

ç›¸ä¼¼åº¦ = cosine_similarity(vector1, vector2)
```

### å®ƒæ˜¯ä»€ä¹ˆ?(Concept)

::: tip ç±»æ¯”æ—¶é—´ï¼šæŠŠæ–‡å­—å˜æˆ GPS åæ ‡
**ä¼ ç»Ÿæœç´¢ï¼ˆå…³é”®è¯ï¼‰ï¼š**
- "åŒ—äº¬è·¯"å’Œ"äº¬åŸå¤§é“"æœä¸å‡ºæ¥ï¼ˆå­—é¢ä¸åŒï¼‰
- å°±åƒåªèƒ½é è·¯ç‰Œæ–‡å­—æ‰¾è·¯

**Embeddingï¼ˆå‘é‡æœç´¢ï¼‰ï¼š**
- æŠŠåœ°å€å˜æˆ GPS åæ ‡ (39.9Â°N, 116.4Â°E)
- è·ç¦»è¿‘çš„åœ°æ–¹å°±æ˜¯"ç›¸ä¼¼"çš„
- "ç‹—"å’Œ"çŠ¬ç±»"åæ ‡å¾ˆè¿‘ï¼ŒAI çŸ¥é“å®ƒä»¬æ˜¯ä¸€å›äº‹

**Embedding = æŠŠæ–‡å­—å˜æˆ GPS åæ ‡** ğŸ“
:::

**Embedding:æ–‡æœ¬çš„æ•°å­—è¡¨ç¤º**

```mermaid
graph LR
    A["æ–‡æœ¬<br/>ç‹—æ˜¯äººç±»çš„æœ‹å‹"] --> B["Embedding æ¨¡å‹<br/>text-embedding-3-small"]
    B --> C["å‘é‡<br/>[0.12, -0.34, 0.56, ..., 0.89]<br/>1536 ç»´"]
    
    D["æ–‡æœ¬<br/>çŠ¬ç±»æ˜¯äººç±»çš„ä¼™ä¼´"] --> B
    B --> E["å‘é‡<br/>[0.11, -0.33, 0.54, ..., 0.87]<br/>1536 ç»´"]
    
    C --> F["è®¡ç®—ç›¸ä¼¼åº¦"]
    E --> F
    F --> G["cosine_similarity<br/>= 0.94<br/>éå¸¸ç›¸ä¼¼!"]
    
    style B fill:#e1f5ff
    style F fill:#fff4e1
    style G fill:#e1ffe1
```

**ä¸»æµ Embedding æ¨¡å‹:**

| æ¨¡å‹ | æä¾›å•† | ç»´åº¦ | æˆæœ¬ | æ€§èƒ½ |
|-----|-------|-----|------|-----|
| **text-embedding-3-small** | OpenAI | 1536 | $0.02/1M tokens | â­â­â­â­ |
| **text-embedding-3-large** | OpenAI | 3072 | $0.13/1M tokens | â­â­â­â­â­ |
| **text-embedding-ada-002** | OpenAI | 1536 | $0.10/1M tokens | â­â­â­ |
| **embed-english-v3.0** | Cohere | 1024 | $0.10/1M tokens | â­â­â­â­ |
| **bge-large-zh-v1.5** | BAAI | 1024 | å…è´¹(è‡ªéƒ¨ç½²) | â­â­â­â­ |

**ç›¸ä¼¼åº¦è®¡ç®—:Cosine Similarity**

```python
import numpy as np

def cosine_similarity(vec1, vec2):
    """è®¡ç®—ä¸¤ä¸ªå‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦"""
    dot_product = np.dot(vec1, vec2)
    norm1 = np.linalg.norm(vec1)
    norm2 = np.linalg.norm(vec2)
    return dot_product / (norm1 * norm2)

# ç¤ºä¾‹
vec_dog = [0.8, 0.1, -0.3]
vec_puppy = [0.78, 0.12, -0.28]
vec_cat = [-0.2, 0.9, 0.5]

print(cosine_similarity(vec_dog, vec_puppy))  # 0.998(éå¸¸ç›¸ä¼¼)
print(cosine_similarity(vec_dog, vec_cat))    # -0.15(ä¸ç›¸ä¼¼)
```

**å‘é‡æ•°æ®åº“:ä¸“ä¸ºå‘é‡æœç´¢è®¾è®¡**

ä¼ ç»Ÿæ•°æ®åº“ vs å‘é‡æ•°æ®åº“:

```
MySQL(ä¼ ç»Ÿ):
SELECT * FROM docs WHERE title LIKE '%ç‹—%';
â†’ ç²¾ç¡®åŒ¹é…,æ— æ³•ç†è§£è¯­ä¹‰

Chroma(å‘é‡æ•°æ®åº“):
SELECT * FROM docs ORDER BY vector_distance(embedding, query_vector) LIMIT 3;
â†’ è¯­ä¹‰æœç´¢,æ‰¾æœ€ç›¸ä¼¼çš„å†…å®¹
```

**ä¸»æµå‘é‡æ•°æ®åº“å¯¹æ¯”:**

| æ•°æ®åº“ | ç±»å‹ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|-------|------|-----|---------|
| **Chroma** | æœ¬åœ°/äº‘ | è½»é‡ã€æ˜“ç”¨ã€Python å‹å¥½ | å¼€å‘ã€å°è§„æ¨¡ |
| **Pinecone** | äº‘æœåŠ¡ | æ‰˜ç®¡ã€é«˜æ€§èƒ½ã€å…è¿ç»´ | ç”Ÿäº§ç¯å¢ƒ |
| **Milvus** | å¼€æº | é«˜æ€§èƒ½ã€åˆ†å¸ƒå¼ã€ä¼ä¸šçº§ | å¤§è§„æ¨¡éƒ¨ç½² |
| **Weaviate** | å¼€æº/äº‘ | GraphQLã€æ··åˆæœç´¢ | å¤æ‚æŸ¥è¯¢ |
| **Qdrant** | å¼€æº/äº‘ | Rust ç¼–å†™ã€é«˜æ€§èƒ½ | æ€§èƒ½è¦æ±‚é«˜ |
| **FAISS** | æœ¬åœ°åº“ | Facebook å¼€æºã€æå¿« | ç ”ç©¶ã€åŸå‹ |

### åŠ¨æ‰‹è¯•è¯•(Practice)

**å®æˆ˜:ç”¨ ChromaDB æ„å»ºæœ¬åœ°å‘é‡æœç´¢**

```python
# 1. å®‰è£…
!pip install chromadb openai

# 2. åˆ›å»ºå‘é‡åº“
import chromadb
from chromadb.utils import embedding_functions

# ä½¿ç”¨ OpenAI Embedding
openai_ef = embedding_functions.OpenAIEmbeddingFunction(
    api_key="your-api-key",
    model_name="text-embedding-3-small"
)

client = chromadb.Client()
collection = client.create_collection(
    name="my_collection",
    embedding_function=openai_ef
)

# 3. æ·»åŠ æ–‡æ¡£
documents = [
    "ç‹—æ˜¯äººç±»æœ€å¿ è¯šçš„æœ‹å‹,å®ƒä»¬èªæ˜ã€å‹å¥½",
    "çŒ«æ˜¯ç‹¬ç«‹çš„åŠ¨ç‰©,å–œæ¬¢å®‰é™çš„ç¯å¢ƒ",
    "çŠ¬ç±»éœ€è¦å®šæœŸè®­ç»ƒå’Œç¤¾äº¤åŒ–",
    "çŒ«å’ªçš„é¥®é£Ÿä¹ æƒ¯ä¸ç‹—å®Œå…¨ä¸åŒ"
]

collection.add(
    documents=documents,
    ids=["doc1", "doc2", "doc3", "doc4"]
)

# 4. æŸ¥è¯¢
results = collection.query(
    query_texts=["å¦‚ä½•è®­ç»ƒç‹—?"],
    n_results=2
)

print("ç›¸å…³æ–‡æ¡£:")
for doc in results['documents'][0]:
    print(f"  - {doc}")

# è¾“å‡º:
# ç›¸å…³æ–‡æ¡£:
#   - çŠ¬ç±»éœ€è¦å®šæœŸè®­ç»ƒå’Œç¤¾äº¤åŒ–
#   - ç‹—æ˜¯äººç±»æœ€å¿ è¯šçš„æœ‹å‹,å®ƒä»¬èªæ˜ã€å‹å¥½
```

**å®Œæ•´ç¤ºä¾‹åœ¨ Notebook:**

<ColabBadge path="demos/12-rag-memory/vector_search.ipynb" />

### å°ç»“(Reflection)

- **è§£å†³äº†ä»€ä¹ˆ**:ç†è§£äº† Embedding çš„åŸç†å’Œå‘é‡æ•°æ®åº“çš„ä½œç”¨
- **æ²¡è§£å†³ä»€ä¹ˆ**:åŸºç¡€ RAG æ£€ç´¢æ•ˆæœä¸ç†æƒ³æ€ä¹ˆåŠ?â€”â€”ä¸‹ä¸€èŠ‚ä»‹ç»é«˜çº§ RAG æŠ€æœ¯
- **å…³é”®è¦ç‚¹**:
  1. **Embedding å°†è¯­ä¹‰è½¬ä¸ºå‘é‡**:è¯­ä¹‰ç›¸ä¼¼ â†’ å‘é‡æ¥è¿‘
  2. **å‘é‡æœç´¢é«˜æ•ˆ**:ç™¾ä¸‡çº§æ–‡æ¡£,æ¯«ç§’çº§æ£€ç´¢
  3. **ä¸»æµ Embedding æ¨¡å‹**:OpenAIã€Cohereã€å¼€æºæ¨¡å‹
  4. **å‘é‡æ•°æ®åº“**:Chroma(ç®€å•)ã€Pinecone(æ‰˜ç®¡)ã€Milvus(ä¼ä¸šçº§)
  5. **ç›¸ä¼¼åº¦è®¡ç®—**:Cosine Similarityã€æ¬§æ°è·ç¦»ã€ç‚¹ç§¯

::: tip ä¸€å¥è¯æ€»ç»“
**Embedding = æŠŠæ–‡å­—å˜æˆ GPS åæ ‡ï¼Œè¯­ä¹‰ç›¸ä¼¼çš„æ–‡æœ¬åæ ‡å°±è¿‘ï¼Œå‘é‡æ•°æ®åº“å°±æ˜¯è¯­ä¹‰æœç´¢å¼•æ“ã€‚**
:::

---

*æœ€åæ›´æ–°:2026-02-20*
